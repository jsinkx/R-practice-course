---
title: 'Анализ данных mtcars'
author: 'Artemiy Voronin SHAD-312 (not sku-f)'
output: html_document
---

# Введение

Этот отчет анализирует встроенный в R датасет `mtcars`.

Документация доступна здесь:

-   [Explore mtcars](https://cran.r-project.org/web/packages/explore/vignettes/explore-mtcars.html)
-   [Описание на W3Schools](https://www.w3schools.com/r/r_stat_data_set.asp)
-   [Youtube сводка по датасету](https://www.youtube.com/watch?v=5G3GUciLRDc)

------------------------------------------------------------------------

```{r}
library(ggplot2)
library(reshape2)

car_list <- list(
  mpg = mtcars$mpg,
  hp = mtcars$hp,
  wt = mtcars$wt,
  cyl = mtcars$cyl,
  gear = mtcars$gear,
  am = mtcars$am,
  vs = mtcars$vs
)

car_list$hp_per_wt <- car_list$hp / car_list$wt # Добавляем новый столбец с расчетом мощности на вес
car_list$transmission <- list(automatic = car_list$am == 0, manual = car_list$am == 1) # Добавляем новый столбец с типом коробки передач

# * Расчеты основных статистик для числовых переменных

means <- sapply(car_list, function(x) if (is.numeric(x)) mean(x, na.rm = TRUE)) # Расчет средних значений по каждому столбцу
print("Средние значения по каждому столбцу")
print(means) # Вывод значений

normalized <- lapply(car_list, function(x) if (is.numeric(x)) (x - min(x)) / (max(x) - min(x)))
print("Нормализованные значения по каждому столбцу")
print(normalized$mpg[1:5])

# * Подготовка датасета
df_car_list <- as.data.frame(car_list)

df_car_list$am <- factor(df_car_list$am, labels = c("Automatic", "Manual")) # Преобразование переменной am в фактор
df_car_list$hp_per_cyl <- df_car_list$hp / df_car_list$cyl # Мощность на цилиндр
df_car_list$log_wt <- log(df_car_list$wt) # Логарифм веса
# Категории расхода топлива
df_car_list$mpg_class <- cut(
  df_car_list$mpg,
  breaks = c(-Inf, 15, 25, Inf),
  labels = c("Low", "Medium", "High")
)

head(df_car_list)

# * Визуализация гистограмма расхода топлива

# Вычисление корреляционной матрицы
numeric_vars <- df_car_list[, sapply(df_car_list, is.numeric)] # Только числовые переменные
cor_matrix <- cor(numeric_vars, use = "complete.obs") # Матрица корреляции

ggplot(df_car_list, aes(x = mpg)) +
  geom_histogram(binwidth = 40, fill = "skyblue", color = "black") +
  labs(
    title = "Распределение расхода топлива",
    x = "Расход топлива (mpg)",
    y = "Частота"
  ) +
  theme_minimal()

# * Визуализация категория расхода топлива (mpg_class)
ggplot(df_car_list, aes(x = mpg_class, fill = mpg_class)) +
  geom_bar() +
  labs(
    title = "Количество автомобилей по классам расхода топлива",
    x = "Класс расхода топлива",
    y = "Количество автомобилей"
  ) +
  scale_fill_manual(values = c("Low" = "red", "Medium" = "yellow", "High" = "green")) +
  theme_minimal()

# * Сохранение в csv
write.csv(df_car_list, "df_car_list.csv", row.names = FALSE)
```
